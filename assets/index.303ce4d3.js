var e,t=Object.assign;import{v as n}from"./vendor.d7b30f5e.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const i=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,s)=>{const a=new URL(e,i);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),o(l)},onload(){n(self[t].moduleMap[a]),o(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("assets/");const i=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),o=(e,t,n)=>{let o,s,a;if(0===t)o=s=a=n;else{const r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;o=i(l,r,e+1/3),s=i(l,r,e),a=i(l,r,e-1/3)}return[Math.round(255*o),Math.round(255*s),Math.round(255*a)]},s=new Array(256);for(let m=0;m<=255;m++){const e=s[255-m]=new Uint8ClampedArray(4),t=m/255*300,n=t>270?(300-t)/30*.5:.5;e.set(o(t/360,1,n),0),e[3]=255}const a=class{constructor(e,t){this.file=e,this.options=t,this.isRendering=!1}getSpectrum(){var e;return null!=(e=this.canvas)?e:null}getBitrate(){if(this.audio){const{duration:e,length:t}=this.audio;return t/e*8}return null}async startRender(e){var n,i,o;if(this.isRendering)return;if(!e)throw new Error("Config missing.");if((!this.audio||e&&e.audioContextOptions!==(null==(n=this.options)?void 0:n.audioContextOptions))&&(this.audio=await(async(e,t)=>new Promise((n=>{const i=new FileReader;i.onloadend=()=>{const e=i.result;new AudioContext(t).decodeAudioData(e).then(n)},i.readAsArrayBuffer(e)})))(this.file,e.audioContextOptions)),this.canvas&&this.options&&(!e||e.height<=this.options.height&&e.width<=this.options.width&&e.minDecibels===this.options.minDecibels&&e.maxDecibels===this.options.maxDecibels))return;this.options=t(t({},this.options),e);let s=2;for(;s/2<e.height;)s*=2;this.isRendering=!0;const r=this.audio,l=await(async e=>{const t=new Array(e.frames),n=new OfflineAudioContext(e.contextOptions),i=n.createAnalyser();Object.assign(i,e.analyzerOptions),i.smoothingTimeConstant=0,i.connect(n.destination);const o=e.buffer.duration/e.frames,s=i.frequencyBinCount;for(let r=0;r<e.frames;r++){const e=r*o;n.suspend(e).then((()=>{n.resume(),i.getByteFrequencyData(t[r]=new Uint8Array(s))}))}const a=n.createBufferSource();return a.buffer=e.buffer,a.connect(i),a.start(),await n.startRendering(),t})({frames:this.options.width,buffer:r,contextOptions:{numberOfChannels:r.numberOfChannels,sampleRate:r.sampleRate,length:r.length},analyzerOptions:{fftSize:s,minDecibels:null!=(i=this.options.minDecibels)?i:-120,maxDecibels:null!=(o=this.options.maxDecibels)?o:-20}}),c=l.length,d=l[0].length,h=new ImageData(c,d),u=a.COLORS;for(let t=0;t<c;t++){const e=l[t];for(let n=0;n<d;n++){const i=e[n];if(i){const e=4*(t+(d-n-1)*c),o=u[i];h.data.set(o,e)}}}const f=this.canvas=document.createElement("canvas");f.width=c,f.height=d,f.getContext("2d",{alpha:!1}).putImageData(h,0,0),this.isRendering=!1}};let r=a;r.COLORS=s;const l=(e,t)=>{let n=2;for(;;){const i=2*n+n%2;if(t/i<e)break;n=i}return[n,t/n]},c=e=>{const{renderer:t,context:n,config:i}=e,{width:o,height:s}=n.canvas;n.resetTransform();const a=t.getSpectrum();if(a){const[e,t,r,l]=i.visuals.graphMargin;n.drawImage(a,l,e,o-t-l,s-e-r),n.translate(.5,.5)}};const d=(h="addEventListener",(e,n,i,o={})=>{e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n];const s=e.map((e=>"string"==typeof e?document.querySelector(e):e));for(const a of s)for(const e of n)a[h](e,i,t({capture:!1},o));return[s,n,i,o]});var h;const u={analyzer:{minDecibels:-120,maxDecibels:-20},audioContextOptions:{sampleRate:48e3},visuals:{graphMargin:[40,100,35,65],decibelBarWidth:10,tickMinDistance:50,tickThickness:1,tickLength:10}},f=()=>{var e,t;let n;const i=document.getElementById("canvas"),o=i.getContext("2d",{alpha:!1}),s=((e,t=500)=>{let n=0,i=-1;return function(...o){const s=performance.now(),a=s-n;a>=t?(clearTimeout(i),e(...o).then((()=>{n=s,i=-1}))):-1===i&&(i=setTimeout((()=>e(...o)),a))}})((async()=>{n&&(await(async e=>{const{renderer:t,context:n,config:{analyzer:i,audioContextOptions:o}}=e,{width:s,height:a}=n.canvas,{minDecibels:r,maxDecibels:l}=i;await t.startRender({width:s,height:a,minDecibels:r,maxDecibels:l,audioContextOptions:o}),c(e)})({renderer:n,context:o,config:u}),a())}),500),a=()=>{const{width:e,height:t}=((e,t=devicePixelRatio)=>{e.width=0,e.height=0;const n=e.getBoundingClientRect();return{width:Math.round(t*n.right)-Math.round(t*n.left),height:Math.round(t*n.bottom)-Math.round(t*n.top)}})(i);i.width=e,i.height=t,(e=>{var t;const{context:n,renderer:i,config:{visuals:o,analyzer:s}}=e;n.resetTransform();const{width:a,height:c}=n.canvas,[d,h,u,f]=o.graphMargin,m=c-d-u,g=a-h-f;n.fillStyle="white",n.strokeStyle="white",n.font="12px monospace",n.textAlign="end",n.textBaseline="hanging",n.fillText("v1.0.0",a-10,10),n.strokeRect(f-.5,d-.5,g+1,m+1);{const e=a-h+10,t=d-1,i=e+o.decibelBarWidth,f=c-u+1,g=n.createLinearGradient(e,t,i,f),p=r.COLORS;for(let n=0;n<p.length;n++){const[e,t,i]=p[p.length-n-1];g.addColorStop(n/p.length,`rgb(${e}, ${t}, ${i})`)}n.fillStyle=g,n.fillRect(e,t,o.decibelBarWidth,m),n.textAlign="left",n.textBaseline="middle";const[w,y]=l(o.tickMinDistance,m),b=s.minDecibels-s.maxDecibels;for(let a=0;a<=w;a++){const e=t+a*y,r=`${Math.floor(a/w*b+s.maxDecibels)} dB`;n.fillStyle=g,n.fillRect(i,e,o.tickLength,o.tickThickness),n.fillStyle="white",n.fillText(r,i+o.tickLength+2,e+1)}}if(null==i?void 0:i.audio){const{sampleRate:e,duration:s,numberOfChannels:a}=i.audio;{const t=m+1,[i,s]=l(o.tickMinDistance,t),a=e/2/1e3;n.textAlign="right",n.textBaseline="middle";for(let e=0;e<=i;e++){const t=d+e*s-1,r=`${Math.floor((i-e)/i*a)} kHz`;n.fillRect(f-o.tickLength,t,o.tickLength,o.tickThickness),n.fillText(r,f-o.tickLength-2,t+1)}}{const e=g+1,[t,i]=l(2*o.tickMinDistance,e);n.textAlign="center",n.textBaseline="hanging",n.font="12px monospace";for(let a=0;a<=t;a++){const e=f+a*i-1,r=(p=Math.floor(a/t*s),`${Math.floor(p/60)}:${String(p%60).padStart(2,"0")}`);n.fillRect(e,d+m,o.tickThickness,o.tickLength),n.fillText(r,e,d+m+o.tickLength+2)}}{const{name:o,type:s}=i.file,r=`${o} (${s}, ${e} Hz, ${(null!=(t=i.getBitrate())?t:0)/1e3}kbps, ${a} channels)`;n.textAlign="left",n.textBaseline="bottom",n.font="14px monospace",n.fillText(r,f,d-8)}}var p})({renderer:n,context:o,config:u}),n&&c({renderer:n,context:o,config:u}),s()},h=()=>{var e;return null==(e=document.getElementById("help"))?void 0:e.classList.toggle("visible")},f=e=>{if(null==n?void 0:n.canvas){const t=n.file.name.replace(/\W+/g,"-").replace(/\.[^.]+$/,"");(e?null==n?void 0:n.canvas:i).toBlob((e=>{e&&((e,t)=>{const n=document.createElement("a");document.body.appendChild(n),n.setAttribute("download",t),n.href=URL.createObjectURL(e),n.click(),document.body.removeChild(n)})(e,`spectrum-${t}.png`)}),"image/png")}};d("#canvas",["dragover","drop"],(e=>{var t;if(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy","drop"===e.type)){const i=null==(t=e.dataTransfer.files)?void 0:t[0];i&&(n=void 0,a(),n=new r(i,{width:screen.availWidth,height:screen.availHeight,maxDecibels:u.analyzer.maxDecibels,minDecibels:u.analyzer.minDecibels}),a())}})),d(window,"keydown",(e=>{var t;if(e.ctrlKey||e.metaKey)switch(e.preventDefault(),e.code){case"KeyS":return f(e.shiftKey);case"ArrowUp":return u.analyzer[e.shiftKey?"minDecibels":"maxDecibels"]+=1,a();case"ArrowDown":return u.analyzer[e.shiftKey?"minDecibels":"maxDecibels"]-=1,a()}else switch(e.code){case"KeyF":return null==(t=document.getElementById("header"))||t.classList.toggle("visible"),a();case"KeyH":return h()}})),window.addEventListener("resize",a),document.addEventListener("fullscreenchange",a),null==(e=document.getElementById("help-screen-btn"))||e.addEventListener("click",h),null==(t=document.getElementById("help"))||t.addEventListener("click",h),a()};"OfflineAudioContext"in window&&"suspend"in window.OfflineAudioContext.prototype?(!function(e={}){const{immediate:t=!1,onNeedRefresh:i,onOfflineReady:o}=e;let s;"serviceWorker"in navigator&&(s=new n("sw.js",{scope:"./"}),s.addEventListener("activated",(e=>{e.isUpdate?window.location.reload():null==o||o()})),s.register({immediate:t}).then((e=>e)))}(),f()):null==(e=document.getElementById("incompatible"))||e.classList.add("visible");
