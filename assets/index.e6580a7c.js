var e,t=Object.assign;import{v as n}from"./vendor.d7b30f5e.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const i=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,s)=>{const a=new URL(e,i);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),o(c)},onload(){n(self[t].moduleMap[a]),o(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("assets/");const i=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),o=(e,t,n)=>{let o,s,a;if(0===t)o=s=a=n;else{const r=n<.5?n*(1+t):n+t-n*t,c=2*n-r;o=i(c,r,e+1/3),s=i(c,r,e),a=i(c,r,e-1/3)}return[Math.round(255*o),Math.round(255*s),Math.round(255*a)]},s=new Array(256);for(let m=0;m<=255;m++){const e=s[255-m]=new Uint8ClampedArray(4),t=m/255*300,n=t>270?(300-t)/30*.5:.5;e.set(o(t/360,1,n),0),e[3]=255}const a=class{constructor(e,t){this.file=e,this.options=t,this.isRendering=!1}getSpectrum(){var e;return null!=(e=this.canvas)?e:null}async startRender(e){var n,i,o;if(this.isRendering)return;if(!e)throw new Error("Config missing.");if((!this.audio||e&&e.audioContextOptions!==(null==(n=this.options)?void 0:n.audioContextOptions))&&(this.audio=await(async(e,t)=>new Promise((n=>{const i=new FileReader;i.onloadend=()=>{const e=i.result;new AudioContext(t).decodeAudioData(e).then(n)},i.readAsArrayBuffer(e)})))(this.file,e.audioContextOptions)),this.canvas&&this.options&&(!e||e.height<=this.options.height&&e.width<=this.options.width&&e.minDecibels===this.options.minDecibels&&e.maxDecibels===this.options.maxDecibels))return;this.options=t(t({},this.options),e);let s=2;for(;s/2<e.height;)s*=2;this.isRendering=!0;const r=this.audio,c=await(async e=>{const t=new Array(e.frames),n=new OfflineAudioContext(e.contextOptions),i=n.createAnalyser();Object.assign(i,e.analyzerOptions),i.smoothingTimeConstant=0,i.connect(n.destination);const o=e.buffer.duration/e.frames,s=i.frequencyBinCount;for(let r=0;r<e.frames;r++){const e=r*o;n.suspend(e).then((()=>{n.resume(),i.getByteFrequencyData(t[r]=new Uint8Array(s))}))}const a=n.createBufferSource();return a.buffer=e.buffer,a.connect(i),a.start(),await n.startRendering(),t})({frames:this.options.width,buffer:r,contextOptions:{numberOfChannels:r.numberOfChannels,sampleRate:r.sampleRate,length:r.length},analyzerOptions:{fftSize:s,minDecibels:null!=(i=this.options.minDecibels)?i:-120,maxDecibels:null!=(o=this.options.maxDecibels)?o:-20}}),l=c.length,d=c[0].length,h=new ImageData(l,d),f=a.COLORS;for(let t=0;t<l;t++){const e=c[t];for(let n=0;n<d;n++){const i=e[n];if(i){const e=4*(t+(d-n-1)*l),o=f[i];h.data.set(o,e)}}}const u=this.canvas=document.createElement("canvas");u.width=l,u.height=d,u.getContext("2d",{alpha:!1}).putImageData(h,0,0),this.isRendering=!1}};let r=a;r.COLORS=s;const c=(e,t)=>{let n=2;for(;;){const i=2*n+n%2;if(t/i<e)break;n=i}return[n,t/n]},l=e=>{const{renderer:t,context:n,config:i}=e,{width:o,height:s}=n.canvas;n.resetTransform();const a=t.getSpectrum();if(a){const[e,t,r,c]=i.visuals.graphMargin;n.drawImage(a,c,e,o-t-c,s-e-r),n.translate(.5,.5)}};const d=(h="addEventListener",(e,n,i,o={})=>{e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n];const s=e.map((e=>"string"==typeof e?document.querySelector(e):e));for(const a of s)for(const e of n)a[h](e,i,t({capture:!1},o));return[s,n,i,o]});var h;const f={analyzer:{minDecibels:-120,maxDecibels:-20},visuals:{graphMargin:[40,100,35,65],decibelBarWidth:10,tickMinDistance:50,tickThickness:1,tickLength:10}},u=()=>{var e,t;let n;const i=document.getElementById("canvas"),o=i.getContext("2d",{alpha:!1}),s=((e,t=500)=>{let n=0,i=-1;return function(...o){const s=performance.now(),a=s-n;a>=t?(clearTimeout(i),e(...o).then((()=>{n=s,i=-1}))):-1===i&&(i=setTimeout((()=>e(...o)),a))}})((async()=>{n&&(await(async e=>{const{renderer:t,context:n,config:i}=e,{width:o,height:s}=n.canvas,{minDecibels:a,maxDecibels:r}=i.analyzer;await t.startRender({width:o,height:s,minDecibels:a,maxDecibels:r}),l(e)})({renderer:n,context:o,config:f}),a())}),500),a=()=>{const{width:e,height:t}=((e,t=devicePixelRatio)=>{e.width=0,e.height=0;const n=e.getBoundingClientRect();return{width:Math.round(t*n.right)-Math.round(t*n.left),height:Math.round(t*n.bottom)-Math.round(t*n.top)}})(i);i.width=e,i.height=t,(e=>{const{context:t,renderer:n,config:{visuals:i,analyzer:o}}=e;t.resetTransform();const{width:s,height:a}=t.canvas,[l,d,h,f]=i.graphMargin,u=a-l-h,m=s-d-f;t.fillStyle="white",t.strokeStyle="white",t.font="12px monospace",t.textAlign="end",t.textBaseline="hanging",t.fillText("v1.0.0",s-10,10),t.strokeRect(f-.5,l-.5,m+1,u+1);{const e=s-d+10,n=l-1,f=e+i.decibelBarWidth,m=a-h+1,g=t.createLinearGradient(e,n,f,m),p=r.COLORS;for(let t=0;t<p.length;t++){const[e,n,i]=p[p.length-t-1];g.addColorStop(t/p.length,`rgb(${e}, ${n}, ${i})`)}t.fillStyle=g,t.fillRect(e,n,i.decibelBarWidth,u),t.textAlign="left",t.textBaseline="middle";const[w,y]=c(i.tickMinDistance,u),b=o.minDecibels-o.maxDecibels;for(let s=0;s<=w;s++){const e=n+s*y,a=`${Math.floor(s/w*b+o.maxDecibels)} dB`;t.fillStyle=g,t.fillRect(f,e,i.tickLength,i.tickThickness),t.fillStyle="white",t.fillText(a,f+i.tickLength+2,e+1)}}if(null==n?void 0:n.audio){const{sampleRate:e,duration:o,numberOfChannels:s}=n.audio;{const n=u+1,[o,s]=c(i.tickMinDistance,n),a=e/2/1e3;t.textAlign="right",t.textBaseline="middle";for(let e=0;e<=o;e++){const n=l+e*s-1,r=`${Math.floor((o-e)/o*a)} kHz`;t.fillRect(f-i.tickLength,n,i.tickLength,i.tickThickness),t.fillText(r,f-i.tickLength-2,n+1)}}{const e=m+1,[n,s]=c(2*i.tickMinDistance,e);t.textAlign="center",t.textBaseline="hanging",t.font="12px monospace";for(let a=0;a<=n;a++){const e=f+a*s-1,r=(g=Math.floor(a/n*o),`${Math.floor(g/60)}:${String(g%60).padStart(2,"0")}`);t.fillRect(e,l+u,i.tickThickness,i.tickLength),t.fillText(r,e,l+u+i.tickLength+2)}}{const{name:i,type:o}=n.file,a=`${i} (${o}, ${e} Hz, ${s} channels)`;t.textAlign="left",t.textBaseline="bottom",t.font="14px monospace",t.fillText(a,f,l-8)}}var g})({renderer:n,context:o,config:f}),n&&l({renderer:n,context:o,config:f}),s()},h=()=>{var e;return null==(e=document.getElementById("help"))?void 0:e.classList.toggle("visible")},u=e=>{if(null==n?void 0:n.canvas){const t=n.file.name.replace(/\W+/g,"-").replace(/\.[^.]+$/,"");(e?null==n?void 0:n.canvas:i).toBlob((e=>{e&&((e,t)=>{const n=document.createElement("a");document.body.appendChild(n),n.setAttribute("download",t),n.href=URL.createObjectURL(e),n.click(),document.body.removeChild(n)})(e,`spectrum-${t}.png`)}),"image/png")}};d("#canvas",["dragover","drop"],(e=>{var t;if(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy","drop"===e.type)){const i=null==(t=e.dataTransfer.files)?void 0:t[0];i&&(n=void 0,a(),n=new r(i,{width:screen.availWidth,height:screen.availHeight,maxDecibels:f.analyzer.maxDecibels,minDecibels:f.analyzer.minDecibels}),a())}})),d(window,"keydown",(e=>{var t;if(e.ctrlKey||e.metaKey)switch(e.preventDefault(),e.code){case"KeyS":return u(e.shiftKey);case"ArrowUp":return f.analyzer[e.shiftKey?"minDecibels":"maxDecibels"]+=1,a();case"ArrowDown":return f.analyzer[e.shiftKey?"minDecibels":"maxDecibels"]-=1,a()}else switch(e.code){case"KeyF":return null==(t=document.getElementById("header"))||t.classList.toggle("visible"),a();case"KeyH":return h()}})),window.addEventListener("resize",a),document.addEventListener("fullscreenchange",a),null==(e=document.getElementById("help-screen-btn"))||e.addEventListener("click",h),null==(t=document.getElementById("help"))||t.addEventListener("click",h),a()};"OfflineAudioContext"in window&&"suspend"in window.OfflineAudioContext.prototype?(!function(e={}){const{immediate:t=!1,onNeedRefresh:i,onOfflineReady:o}=e;let s;"serviceWorker"in navigator&&(s=new n("sw.js",{scope:"./"}),s.addEventListener("activated",(e=>{e.isUpdate?window.location.reload():null==o||o()})),s.register({immediate:t}).then((e=>e)))}(),u()):null==(e=document.getElementById("incompatible"))||e.classList.add("visible");
